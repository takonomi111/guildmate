<!DOCTYPE html>
<html>
<head>
    <title>GuildMate - ãƒ¡ãƒ³ãƒãƒ¼ä¸€è¦§</title>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
        }
        .card-tag {
            background: #e0f0ff;
            padding: 0.2em 0.6em;
            border-radius: 0.5em;
            margin-right: 0.3em;
            font-size: 0.9em;
        }
        .card-game {
            background: #fff4e0;
            padding: 0.2em 0.6em;
            border-radius: 0.5em;
            margin-right: 0.3em;
            font-size: 0.9em;
        }
        mark {
            background-color: #ffd54f;
            padding: 0 0.2em;
            border-radius: 3px;
        }
        body.dark-mode {
            background-color: #121212;
            color: #f0f0f0;
        }
        body.dark-mode .card {
            background-color: #1e1e1e;
            color: #f0f0f0;
        }
        body.dark-mode .card-footer {
            background-color: #1e1e1e;
        }
    </style>
</head>
<body>
<div class="container py-4">

    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1 class="mb-0">GuildMate</h1>
        <div class="d-flex gap-2">
            <a href="{{ url_for('dashboard') }}" class="btn btn-outline-dark">ğŸ“Š ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</a>
            <a href="{{ url_for('list_events') }}" class="btn btn-outline-dark me-2">ğŸ“… ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§</a>
            <a href="{{ url_for('calendar_view') }}" class="btn btn-outline-secondary me-2">ğŸ—“ ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</a>
            <button class="btn btn-outline-secondary" onclick="toggleMode()">ğŸŒ“ ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿</button>
        </div>
    </div>

    <!-- æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ  -->
    <form method="get" class="mb-3">
        <div class="input-group">
            <input type="text" name="q" class="form-control" placeholder="åå‰ãƒ»ã‚¿ã‚°ãƒ»ã‚²ãƒ¼ãƒ ãªã©" value="{{ keyword }}">
            <button class="btn btn-primary" type="submit">æ¤œç´¢</button>
        </div>
    </form>

    <!-- ã‚¿ã‚°ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
    <div class="mb-2"><strong>ã‚¿ã‚°:</strong>
        {% for tag in all_tags %}
            <a href="{{ url_for('index', tag=tag.name) }}" class="btn btn-sm {% if selected_tag == tag.name %}btn-secondary{% else %}btn-outline-secondary{% endif %}">{{ tag.name }}</a>
        {% endfor %}
    </div>

    <!-- ã‚²ãƒ¼ãƒ ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
    <div class="mb-2"><strong>ã‚²ãƒ¼ãƒ :</strong>
        {% for game in all_games %}
            <a href="{{ url_for('index', game=game.name) }}" class="btn btn-sm {% if selected_game == game.name %}btn-dark{% else %}btn-outline-dark{% endif %}">{{ game.name }}</a>
        {% endfor %}
    </div>

    <!-- ã‚¹ã‚¿ãƒ¼ä»˜ããƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
    <div class="mb-3">
        <strong>ãŠæ°—ã«å…¥ã‚Š:</strong>
        <a href="{{ url_for('index') }}" class="btn btn-sm {% if not favorite_only %}btn-outline-warning{% else %}btn-outline-secondary{% endif %}">ã™ã¹ã¦</a>
        <a href="{{ url_for('index', favorite='on') }}" class="btn btn-sm {% if favorite_only %}btn-warning{% else %}btn-outline-warning{% endif %}">â˜…ã®ã¿</a>
    </div>

    <!-- ä¸¦ã³æ›¿ãˆ -->
    <div class="mb-3">
        ä¸¦ã³æ›¿ãˆ:
        <a href="{{ url_for('index', sort='name') }}" class="btn btn-sm {% if selected_sort == 'name' %}btn-success{% else %}btn-outline-success{% endif %}">åå‰é †</a>
        <a href="{{ url_for('index', sort='latest') }}" class="btn btn-sm {% if selected_sort == 'latest' %}btn-success{% else %}btn-outline-success{% endif %}">æ–°ã—ã„é †</a>
        <a href="{{ url_for('index', sort='oldest') }}" class="btn btn-sm {% if selected_sort == 'oldest' %}btn-success{% else %}btn-outline-success{% endif %}">å¤ã„é †</a>
        <a href="{{ url_for('index', sort='favorite') }}" class="btn btn-sm {% if selected_sort == 'favorite' %}btn-success{% else %}btn-outline-success{% endif %}">â˜…å„ªå…ˆ</a>
    </div>

    <div class="text-end mb-4">
        <a href="{{ url_for('add_member') }}" class="btn btn-primary">ï¼‹ ãƒ¡ãƒ³ãƒãƒ¼è¿½åŠ </a>
    </div>

    <!-- ãƒ¡ãƒ³ãƒãƒ¼ã‚«ãƒ¼ãƒ‰ -->
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
        {% for member in members %}
        <div class="col">
            <div class="card h-100 shadow-sm">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start">
                        <h5 class="card-title">{{ member.name|highlight(keyword)|safe }}</h5>
                        <!-- ã‚¹ã‚¿ãƒ¼åˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ -->
                        <form action="{{ url_for('toggle_favorite', member_id=member.id) }}" method="post">
                            <button type="submit" class="btn btn-sm {% if member.favorite %}btn-warning{% else %}btn-outline-secondary{% endif %}">
                                {% if member.favorite %}â˜…{% else %}â˜†{% endif %}
                            </button>
                        </form>
                    </div>
                    <p class="card-text">{{ member.note|highlight(keyword)|safe }}</p>
                    <div>
                        {% for tag in member.tags %}
                            <span class="card-tag">{{ tag.name|highlight(keyword)|safe }}</span>
                        {% endfor %}
                        {% for game in member.games %}
                            <span class="card-game">{{ game.name|highlight(keyword)|safe }}</span>
                        {% endfor %}
                    </div>
                </div>
                <div class="card-footer text-end bg-white border-top-0">
                    <a href="{{ url_for('edit_member', member_id=member.id) }}" class="btn btn-sm btn-outline-primary">ç·¨é›†</a>
                    <form action="{{ url_for('delete_member', member_id=member.id) }}" method="post" style="display:inline;">
                        <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')">å‰Šé™¤</button>
                    </form>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<!-- ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
<script>
function toggleMode() {
    document.body.classList.toggle("dark-mode");
    const isDark = document.body.classList.contains("dark-mode");
    localStorage.setItem("theme", isDark ? "dark" : "light");
}
window.onload = () => {
    if (localStorage.getItem("theme") === "dark") {
        document.body.classList.add("dark-mode");
    }
};
</script>
</body>
</html>
